---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import Sidebar from '../components/Sidebar.astro';
import Pattern from '../components/Pattern.astro';

import fs from 'node:fs/promises';
import path from 'node:path';
import Header from '../components/Header.astro';

// Get the absolute path to the patterns directory
const patternsPath = path.resolve(process.cwd(), 'src/patterns');

// Read all entries in the directory, filter for sub-directories, and get their names.
// This is the same logic used in Sidebar.astro to ensure consistency.
const patternNames = (await fs.readdir(patternsPath, { withFileTypes: true }))
  .filter(dirent => dirent.isDirectory())
  .map(dirent => dirent.name);

const patterns = patternNames.map(name => {
  const id = name.toLowerCase().replace(/\s+/g, '-');
  return { name, id };
});
---

<Layout title="Open Patterns">
  <Header patterns={patterns} />
  <main class="app-container">
    <Sidebar patterns={patterns} />
    <div class="main-content">
      {patternNames.map(name => (
        <Pattern patternName={name} />
      ))}
    </div>
  </main>
</Layout>